pipeline {
    agent any

    tools {
        jdk 'jdk17'
        maven 'maven3'
    }

    stages {
        stage('Checkout Code') {
            steps {
                echo 'Checking out code...'
                checkout scm
            }
        }

        stage('Build brief-service') {
            steps {
                // This dir command ensures the build runs from the correct project root
                dir('enaa-skills-backend') {
                    echo "--- Building inside: "

                    // Grant execute permission to the Maven Wrapper
                    sh 'chmod +x mvnw'

                    // Execute the Maven build for the 'brief-service' module
                    // The -f flag points to the module's specific pom.xml
                    sh './mvnw -f brief-service/pom.xml clean package -DskipTests'
                }
            }
        }

        stage('Archive Artifact') {
            steps {
                echo 'Archiving the artifact...'
                // The path is relative to the workspace root
                archiveArtifacts artifacts: 'enaa-skills-backend/brief-service/target/*.jar', fingerprint: true
            }
        }
    }
}
