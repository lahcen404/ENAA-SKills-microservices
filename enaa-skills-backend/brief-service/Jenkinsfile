pipeline {
    // comment for testing webhoook2
    agent any // run on any machine

    tools {
        // softwares needs in build
        jdk 'jdk17'
        maven 'maven3'
    }

    stages {
        stage('Checkout Code') {
            steps {
                // download code from git Repo
                echo 'Checking out code...'
                checkout scm
            }
        }

        stage('Build & Test') {
            steps {
                // run command tools compile
             echo 'Building the brief-service application...'

             // --- DEBUGGING ---
             echo "--- Current Directory is: ---"
             sh 'pwd'
             echo "--- Listing contents to confirm new structure: ---"
             sh 'ls -la'

             // Change into the backend directory where the project now lives
             dir('enaa-skills-backend') {
                    echo "--- Now running commands inside: $(pwd) ---"
                sh 'ls -la'

                // Grant execute permission to mvnw, which is in the current directory.
                sh 'chmod +x mvnw'

                // Run mvnw from the enaa-skills-backend directory, telling it to build the 'brief-service' module.
                // The -f flag points to the module's specific pom.xml file.
                sh './mvnw -f brief-service/pom.xml clean package -DskipTests'
             }
            }
        }

        stage('Archive Artifact') {
            steps {
                // find the built .jar file
                echo 'Archiving the artifact...'
                // The path to the artifact must now include the new parent directory.
                archiveArtifacts artifacts: 'enaa-skills-backend/brief-service/target/*.jar', fingerprint: true
            }
        }
    }
}